<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>ç¯çƒç¾æ™¯æ˜ä¿¡ç‰‡</title>
    <link rel="stylesheet" href="css/post.css">
    <script src="js/post.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <style>
        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            overflow: hidden;
        }
        .modal-content img {
            cursor: grab;
            transition: transform 0.1s ease;
        }
        .close {
            position: fixed;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 34px;
            cursor: pointer;
            z-index: 999;
        }
        
    </style>
    <script>
        let scale = 1; // å½“å‰ç¼©æ”¾æ¯”ä¾‹
        let isDragging = false;
        let startX, startY, initialX, initialY;

        function getParameterByName(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }

        function getCountryName(flagImg) {
            const filename = flagImg.split('/').pop();
            const countryName = filename.split('.')[0];
            return countryName.charAt(0).toUpperCase() + countryName.slice(1);
        }

        function addReadButtons() {
            const descrCn = document.getElementById('descr-cn');
            const englishParagraphs = descrCn.getElementsByClassName('word-en');
            Array.from(englishParagraphs).forEach(paragraph => {
                const text = paragraph.innerText;
                const button = document.createElement('button');
                button.innerText = 'ğŸ”ˆ';

                button.onclick = () => {
                    button.innerText = 'ğŸ‘„'; // æ”¹å˜æŒ‰é’®æ–‡æœ¬
                    responsiveVoice.speak(text, "UK English Male", {
                        onend: () => button.innerText = 'ğŸ”ˆ' // æ’­æ”¾ç»“æŸåæ¢å¤æ–‡æœ¬
                    });
                };
                paragraph.appendChild(button);
            });
        }

        function setNavigationLinks() {
            const p = parseInt(getParameterByName('p'));
            const totalPages = 100;
            const previous = (p === 1) ? totalPages : p - 1;
            const next = (p === totalPages) ? 1 : p + 1;

            const previousLink = document.getElementById('previous-link');
            const nextLink = document.getElementById('next-link');

            previousLink.href = `p.html?p=${previous}`;
            nextLink.href = `p.html?p=${next}`;

            previousLink.onclick = function() {
                this.classList.add('fly-left');
                setTimeout(() => {
                    window.location.href = this.href; // ç­‰å¾…åŠ¨ç”»ç»“æŸåè·³è½¬
                }, 500); // ä¸åŠ¨ç”»æ—¶é•¿ç›¸åŒ
            };

            nextLink.onclick = function() {
                this.classList.add('fly-right');
                setTimeout(() => {
                    window.location.href = this.href; // ç­‰å¾…åŠ¨ç”»ç»“æŸåè·³è½¬
                }, 500); // ä¸åŠ¨ç”»æ—¶é•¿ç›¸åŒ
            };
        }

        function showImageModal() {
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-image');
            const imageSrc = document.getElementById('image').src;
            modalImg.src = imageSrc; // è®¾ç½®å¼¹çª—ä¸­çš„å›¾ç‰‡
            modal.style.display = 'flex'; // æ˜¾ç¤ºå¼¹çª—
            scale = 1; // é‡ç½®ç¼©æ”¾æ¯”ä¾‹
            modalImg.style.transform = `scale(${scale}) translate(0, 0)`; // åº”ç”¨ç¼©æ”¾
            initialX = 0; initialY = 0; // åˆå§‹åŒ–ä½ç½®
        }

        function closeModal() {
            const modal = document.getElementById('image-modal');
            modal.style.display = 'none'; // éšè—å¼¹çª—
        }

        function handleTouchMove(event) {
            if (event.touches.length === 2) {
                const touch1 = event.touches[0];
                const touch2 = event.touches[1];
                const distance = Math.sqrt(Math.pow(touch2.clientX - touch1.clientX, 2) + Math.pow(touch2.clientY - touch1.clientY, 2));

                if (this.lastDistance) {
                    if (distance > this.lastDistance) {
                        scale *= 1.1; // æ”¾å¤§
                    } else {
                        scale *= 0.9; // ç¼©å°
                    }
                    document.getElementById('modal-image').style.transform = `scale(${scale}) translate(${initialX}px, ${initialY}px)`;
                }
                this.lastDistance = distance;
            }
        }

        function handleTouchEnd() {
            this.lastDistance = null; // é‡ç½®è·ç¦»
        }

        function startDrag(event) {
            isDragging = true;
            startX = event.clientX || event.touches[0].clientX;
            startY = event.clientY || event.touches[0].clientY;
        }

        function drag(event) {
            if (isDragging) {
                const modalImg = document.getElementById('modal-image');
                const x = (event.clientX || event.touches[0].clientX) - startX;
                const y = (event.clientY || event.touches[0].clientY) - startY;
                initialX += x;
                initialY += y;
                modalImg.style.transform = `scale(${scale}) translate(${initialX}px, ${initialY}px)`;
                startX = event.clientX || event.touches[0].clientX;
                startY = event.clientY || event.touches[0].clientY;
            }
        }

        function endDrag() {
            isDragging = false;
        }

        function updateClock() {
            const now = new Date();
            const formattedDate = `${now.getFullYear()}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            document.getElementById('clock').innerText = formattedDate;
        }

        window.onload = function() {
            const p = getParameterByName('p');
            if (data[p]) {
                document.getElementById('title-cn').innerText = data[p].title_cn;
                document.getElementById('title-en').innerText = data[p].title_en;
                document.getElementById('adress-cn').innerText = data[p].adress_cn;
                document.getElementById('adress-en').innerText = data[p].adress_en;
                document.getElementById('image').src = data[p].img;
                document.getElementById('country-flag').src = data[p].country_flag_img;
                document.getElementById('descr-cn').innerHTML = data[p].descr_cn;

                const countryName = getCountryName(data[p].country_flag_img);
                document.getElementById('country-name').innerText = countryName;

                // æ·»åŠ æœ—è¯»æŒ‰é’®
                addReadButtons();

                // è®¾ç½®å¯¼èˆªé“¾æ¥
                setNavigationLinks();

                // æ·»åŠ ç‚¹å‡»å›¾ç‰‡äº‹ä»¶
                document.getElementById('image').onclick = showImageModal;

                // ç»‘å®šè§¦æ‘¸äº‹ä»¶
                const modalImg = document.getElementById('modal-image');
                modalImg.addEventListener('touchmove', handleTouchMove);
                modalImg.addEventListener('touchend', handleTouchEnd);
                modalImg.addEventListener('mousedown', startDrag);
                modalImg.addEventListener('mousemove', drag);
                modalImg.addEventListener('mouseup', endDrag);
                modalImg.addEventListener('mouseleave', endDrag);
            }
            // å¯åŠ¨æ—¶é’Ÿæ›´æ–°
            setInterval(updateClock, 1000);
        };
    </script>
</head>
<body>
    
    
    <div class="container">
	
        <img id="image" alt="åŠ¨æ€å›¾ç‰‡" src="img/loading.gif" />
		<div class="clock" id="clock"><span>2024.10.09 12:51:25</span></div> <!-- æ—¶é’Ÿ -->
        <div class="nav-links">
            <a id="previous-link" href="#"><b>âœˆ</b></a>
            <a id="next-link" href="#"><b>âœˆ</b></a>
        </div>
        <div class="sec">
            <img id="country-flag" class="flag" alt="å›½æ——" src="img/positioning.gif" />
            <div id="country-name" class="country"></div>
            <div class="sec_right">
                <div class="sec_cn">  
                    <h1 id="title-cn">æ™¯åŒºåç§°åŠ è½½ä¸­...</h1> 
                    <div class="address" id="adress-cn">æ™¯åŒºä½ç½®åŠ è½½ä¸­...</div>
                </div>
                <div class="sec_en"> 
                    <h1 id="title-en">Attraction name loading...</h1>
                    <div class="address" id="adress-en">Attractions are loading..</div>
                    <div class="clear"></div>
                </div>   
            </div>
        </div>
        
        <div class="description" id="descr-cn">æ™¯ç‚¹ä»‹ç»åŠ è½½ä¸­...</div>
        <div class="description" id="descr-en">Attractions introduction loading...</div>
    </div>

    <!-- å¼¹çª—ç»“æ„ -->
    <div id="image-modal" class="modal">
        <div class="modal-content" onclick="closeModal()"> <!-- ç‚¹å‡»å¼¹çª—å†…å®¹åŒºåŸŸå…³é—­ -->
            <span class="close" onclick="closeModal()">&times;</span>
            <img id="modal-image" alt="æ”¾å¤§å›¾ç‰‡" />
        </div>
    </div>

    <div class="copyright">å±±æµ·è‰æœˆæ–‡åŒ–ç‰ˆæƒæ‰€æœ‰<br>
        <span>è¯¥ç³»åˆ—æ‰€é‡‡ç”¨çš„æ‘„å½±å›¾ç‰‡å‡ä¸ºä»˜è´¹è´­ä¹°ä½¿ç”¨ï¼Œè¯¥å¥—æ˜ä¿¡ç‰‡ç”±å±±æµ·è‰æœˆæŒ‡å®šåº—é“ºç”Ÿäº§å”®å–ï¼Œå…¶ä½™åº—é“ºæœªç»å…è®¸ï¼Œä¸å¾—ä¾µçŠ¯ç‰ˆæƒã€æ“…è‡ªé”€å”®ã€‚</span>
    </div>
</body>
</html>
